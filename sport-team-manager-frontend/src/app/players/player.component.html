<div class="row justify-content-center fade-in">
  <div class="col-12">
    <div class="page-header mb-4">
      <h2 class="mb-2">
        <span class="material-icons">person</span>
        {{ title }}
      </h2>
      <p class="text-muted mb-0" *ngIf="isEditMode">Editando informações do jogador</p>
      <p class="text-muted mb-0" *ngIf="!isEditMode">Adicione um novo jogador ao time</p>
    </div>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-xl-10">
    <div class="card">
      <div class="card-body">
        <div *ngIf="loading" class="loading-spinner">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Carregando...</span>
          </div>
        </div>

        <form *ngIf="!loading" [formGroup]="playerForm" (ngSubmit)="onSubmit()">
          
          <!-- ✅ NOVO: Seleção de Time -->
          <div class="form-row" *ngIf="teams.length > 0">
            <div class="col-12 form-col">
              <label for="teamId" class="form-label">Time *</label>
              <select 
                class="form-select" 
                id="teamId" 
                formControlName="teamId"
                [class.is-invalid]="playerForm.get('teamId')?.invalid && playerForm.get('teamId')?.touched">
                <option value="">Selecione um time</option>
                <option *ngFor="let team of teams" [value]="team.id">
                  {{ team.name }} - {{ team.coachName }} ({{ team.sportType }})
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="playerForm.get('teamId')?.errors?.['required']">
                Seleção de time é obrigatória
              </div>
              
              <!-- ✅ Mostra o time selecionado -->
              <div *ngIf="playerForm.get('teamId')?.value" class="team-selection-info">
                <small class="text-success">
                  <span class="material-icons">check_circle</span>
                  Jogador será vinculado ao time: <strong>{{ getSelectedTeamName() }}</strong>
                </small>
              </div>
            </div>
          </div>

          <!-- Informações Básicas -->
          <div class="form-row">
            <div class="col-md-6 form-col">
              <label for="name" class="form-label">Nome completo *</label>
              <input 
                type="text" 
                class="form-control" 
                id="name" 
                formControlName="name"
                placeholder="Ex: João Silva Santos"
                [class.is-invalid]="playerForm.get('name')?.invalid && playerForm.get('name')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('name')?.errors?.['required']">
                Nome é obrigatório
              </div>
              <div class="invalid-feedback" *ngIf="playerForm.get('name')?.errors?.['minlength']">
                Nome deve ter pelo menos 2 caracteres
              </div>
              <span class="help-text">Digite o nome completo do jogador</span>
            </div>

            <div class="col-md-6 form-col">
              <label for="age" class="form-label">Idade *</label>
              <input 
                type="number" 
                class="form-control" 
                id="age" 
                formControlName="age"
                min="16"
                max="50"
                [class.is-invalid]="playerForm.get('age')?.invalid && playerForm.get('age')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('age')?.errors?.['required']">
                Idade é obrigatória
              </div>
              <div class="invalid-feedback" *ngIf="playerForm.get('age')?.errors?.['min'] || playerForm.get('age')?.errors?.['max']">
                Idade deve estar entre 16 e 50 anos
              </div>
            </div>
          </div>

          <!-- Posição e Número -->
          <div class="form-row">
            <div class="col-md-6 form-col">
              <label for="position" class="form-label">Posição *</label>
              <select 
                class="form-select" 
                id="position" 
                formControlName="position"
                [class.is-invalid]="playerForm.get('position')?.invalid && playerForm.get('position')?.touched">
                <option value="">Selecione uma posição</option>
                <option *ngFor="let position of positions" [value]="position">
                  {{ position }}
                </option>
              </select>
              <div class="invalid-feedback" *ngIf="playerForm.get('position')?.errors?.['required']">
                Posição é obrigatória
              </div>
            </div>

            <div class="col-md-6 form-col">
              <label for="jerseyNumber" class="form-label">Número da Camisa *</label>
              <input 
                type="text" 
                class="form-control" 
                id="jerseyNumber" 
                formControlName="jerseyNumber"
                placeholder="Ex: 10"
                [class.is-invalid]="playerForm.get('jerseyNumber')?.invalid && playerForm.get('jerseyNumber')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('jerseyNumber')?.errors?.['required']">
                Número da camisa é obrigatório
              </div>
              <div class="invalid-feedback" *ngIf="playerForm.get('jerseyNumber')?.errors?.['pattern']">
                Apenas números são permitidos
              </div>
            </div>
          </div>

          <!-- Datas Importantes -->
          <div class="form-row">
            <div class="col-md-6 form-col">
              <label for="birthDate" class="form-label">Data de Nascimento *</label>
              <input 
                type="date" 
                class="form-control" 
                id="birthDate" 
                formControlName="birthDate"
                [class.is-invalid]="playerForm.get('birthDate')?.invalid && playerForm.get('birthDate')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('birthDate')?.errors?.['required']">
                Data de nascimento é obrigatória
              </div>
            </div>

            <div class="col-md-6 form-col">
              <label for="joinDate" class="form-label">Data de Ingresso *</label>
              <input 
                type="date" 
                class="form-control" 
                id="joinDate" 
                formControlName="joinDate"
                [class.is-invalid]="playerForm.get('joinDate')?.invalid && playerForm.get('joinDate')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('joinDate')?.errors?.['required']">
                Data de ingresso é obrigatória
              </div>
            </div>
          </div>

          <!-- Características Físicas -->
          <div class="form-row">
            <div class="col-md-4 form-col">
              <label for="height" class="form-label">Altura (m) *</label>
              <input 
                type="number" 
                step="0.01" 
                class="form-control" 
                id="height" 
                formControlName="height"
                min="1.50"
                max="2.20"
                placeholder="1.80"
                [class.is-invalid]="playerForm.get('height')?.invalid && playerForm.get('height')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('height')?.errors?.['required']">
                Altura é obrigatória
              </div>
              <div class="invalid-feedback" *ngIf="playerForm.get('height')?.errors?.['min'] || playerForm.get('height')?.errors?.['max']">
                Altura deve estar entre 1.50m e 2.20m
              </div>
            </div>

            <div class="col-md-4 form-col">
              <label for="weight" class="form-label">Peso (kg) *</label>
              <input 
                type="number" 
                step="0.1" 
                class="form-control" 
                id="weight" 
                formControlName="weight"
                min="50"
                max="120"
                placeholder="75.0"
                [class.is-invalid]="playerForm.get('weight')?.invalid && playerForm.get('weight')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('weight')?.errors?.['required']">
                Peso é obrigatório
              </div>
              <div class="invalid-feedback" *ngIf="playerForm.get('weight')?.errors?.['min'] || playerForm.get('weight')?.errors?.['max']">
                Peso deve estar entre 50kg e 120kg
              </div>
            </div>

            <div class="col-md-4 form-col">
              <label for="nationality" class="form-label">Nacionalidade *</label>
              <input 
                type="text" 
                class="form-control" 
                id="nationality" 
                formControlName="nationality"
                placeholder="Ex: Brasileira"
                [class.is-invalid]="playerForm.get('nationality')?.invalid && playerForm.get('nationality')?.touched">
              <div class="invalid-feedback" *ngIf="playerForm.get('nationality')?.errors?.['required']">
                Nacionalidade é obrigatória
              </div>
            </div>
          </div>

          <!-- Status (apenas no modo edição) -->
          <div class="form-row" *ngIf="isEditMode">
            <div class="col-12 form-col">
              <div class="form-check form-switch">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  role="switch"
                  id="isActive" 
                  formControlName="isActive">
                <label class="form-check-label fw-medium" for="isActive">
                  Jogador ativo no time
                </label>
                <span class="help-text">Desative para remover o jogador do elenco atual</span>
              </div>
            </div>
          </div>

          <!-- Botões -->
          <div class="form-row mt-4">
            <div class="col-12">
              <div class="d-flex gap-3 justify-content-end border-top pt-4">
                <button type="button" class="btn btn-secondary" (click)="cancel()">
                  <span class="material-icons">arrow_back</span>
                  Voltar
                </button>
                <button 
                  type="submit" 
                  class="btn btn-primary" 
                  [disabled]="submitting || playerForm.invalid">
                  <span *ngIf="submitting" class="spinner-border spinner-border-sm me-2"></span>
                  <span class="material-icons">{{ isEditMode ? 'save' : 'add' }}</span>
                  {{ isEditMode ? 'Atualizar Jogador' : 'Criar Jogador' }}
                </button>
              </div>
            </div>
          </div>
        </form>

        <!-- ✅ Mensagem se não houver times -->
        <div *ngIf="teams.length === 0 && !loading" class="alert alert-warning">
          <span class="material-icons">warning</span>
          Nenhum time encontrado. Você precisa criar um time antes de adicionar jogadores.
          <button class="btn btn-sm btn-outline-primary ms-2" routerLink="/teams/new">
            Criar Time
          </button>
        </div>
      </div>
    </div>
  </div>
</div>